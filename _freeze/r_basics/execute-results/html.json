{
  "hash": "9ceb412151eb428d365b869895163fab",
  "result": {
    "markdown": "# Làm sạch (p1)\n\n::: callout-note\n## Trước buổi học\n\n-   Tải data thực hành\n\n\n{{< downloadthis data/vaccine_data.xlsx dname=\"vaccine_data\" label=\"vaccine_data.xlsx\" type=light >}} {{< downloadthis data/practising_cert.csv dname=\"practising_cert\" label=\"practising_cert.xlsx\" type=light >}} {{< downloadthis data/life-exp.csv dname=\"life-exp\" label=\"life-exp.csv\" type=light >}}\n\n\n\n-   Cái đặt các package sau (chỉ cần làm 1 lần):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(c(\"tidyverse\", \"readxl\", \"writexl\", \"stringi\", \"janitor\"))\n```\n:::\n\n\n-   Và load các package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(writexl)\nlibrary(readxl)\nlibrary(stringi)\nlibrary(janitor)\n```\n:::\n\n:::\n\n::: callout-tip\n# Mục tiêu\n\n1.  Hiểu các thuật ngữ trong R\n2.  Hiểu các datatype trong R\n3.  Học các thao tác cơ bản khi làm việc với data.frame\n4.  Học về các package hỗ trợ khi làm việc với các datatype phức tạp hơn (string, Date)\n:::\n\n## Tại sao làm sạch số liệu bằng R?\n\nSử dụng R để làm sạch số liệu có nhiều ưu điểm hơn dùng excel:\n\n-   R có nhiều chức năng tìm và sàng lọc vấn đề cần làm sạch: Có thể viết thành 1 quy trình kiểm tra dữ liệu tự động, kết hợp thống kê mô tả và trực quan hóa để phát hiện vấn đề cần làm sạch. Có nhiều chức năng đã được các tác giả khác viết thành những package thuận tiện cho việc sử dụng.\n\n-   Tất cả các công đoạn làm sạch đều được lưu lại: Chúng ta có thể lưu thành file R code hoặc Rmd, trong đó mỗi câu lệnh là 1 hay nhiều bước làm sạch. Trong tương lai, chỉ cần đọc file R code hoặc Rmd để dễ dàng tra cứu lại những thay đổi giữa file số liệu được phân tích và file gốc. Nếu dự án nghiên cứu có thành viên mới tham gia, quá trình chuyển giao công việc sẽ thuận lợi hơn vì mọi thứ đều được lưu trong file R code hoặc Rmd nên sẽ không sợ bị sót hay quên thông tin.\n\n-   Tiết kiệm thời gian làm sạch số liệu mới: Nếu tiếp tục các đợt thu thập số liệu mới, có thể tái sử dụng file R code hoặc Rmd để làm sạch các vấn đề tương tự đã gặp trong số liệu cũ đã xử lý.\n\n## Đối tượng trong R\n\nMọi thứ được lưu trữ trong R - bao gồm bộ dữ liệu, biến số, danh sách tên cột, kết quả đầu ra như biểu đồ - đều là **các đối tượng**, được **gán tên** và **có thể được tham chiếu** trong các lệnh sau đó.\n\nĐể tạo đối tượng trong R, ta dùng cú pháp sau\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntên_đối_tượng <- giá_trị_của_đối_tượng \n```\n:::\n\n\n**VD**: Đọc file `vaccine_data.xlsx` để sử dụng trong bài học\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# tạo đối tượng file_path để lưu trữ đường dẫn đến file excel\ndata_path <- \"data/vaccine_data.xlsx\"\n\n# tạo đối tượng df lưu trữ bảng dữ liệu đọc từ file excel\ndf <- read_excel(path = data_path)\n```\n:::\n\n\nSau khi tạo các đối tượng, ta có thể thử xem giá trị được lưu trữ\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_path\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data/vaccine_data.xlsx\"\n```\n:::\n\n```{.r .cell-code}\n# sử dụng lệnh head để xem 6 hàng đầu thay vì toàn bộ bảng\nhead(df) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 21\n     id gioitinh ngaysinh   huyen    xa    tinh  `VGB <24` `VGB >24` VGB_1 VGB_2\n  <dbl> <chr>    <chr>      <chr>    <chr> <chr> <chr>     <chr>     <chr> <chr>\n1     1 nam      27/02/2024 Bình Ch… Phườ… Thàn… 28/02/20… 29/02/20… 10/0… 20/0…\n2     2 nữ       06/03/2024 Huyện T… Phườ… Thàn… 07/03/20… 08/03/20… 23/0… 27/0…\n3     3 nữ       27/01/2024 Thành p… Phườ… Thàn… 28/01/20… 29/01/20… 08/0… 18/0…\n4     4 nữ       12/02/2024 Hóc Môn  Xã Đ… Thàn… 13/02/20… 14/02/20… 17/0… 27/0…\n5     5 nữ       21/02/2024 Bình Ch… Xã B… Thàn… 21/02/20… 20/02/20… 23/0… 09/0…\n6     6 nữ       07/03/2024 Quận 7   Phú … Thàn… 07/03/20… 08/03/20… 23/0… 02/0…\n# ℹ 11 more variables: VGB_3 <chr>, `VGB_4+` <chr>, HG_1 <chr>, HG_2 <chr>,\n#   HG_3 <chr>, `HG_4+` <chr>, UV_1 <chr>, UV_2 <chr>, UV_3 <chr>,\n#   `UV_4+` <chr>, tinhtrang <chr>\n```\n:::\n:::\n\n```{=html}\n<details>\n  <summary>\n    Thông tin về <code>vaccine_data</code>\n  </summary>\n```\n\nBộ dữ liệu được tạo ra dựa trên **format** của dữ liệu tiêm chủng. Giá trị của bộ dữ liệu là giả, được tạo một cách ngẫu nhiên và có thể không khớp với lịch tiêm chủng thực tế.\n\nNhiều giá trị được làm sai (dữ liệu thiếu, mũi 2 trước mũi 1, địa chỉ không phù hợp, ...) có chủ đích cho bài học làm sạch phần 2\n\n***Từ điển biến số***\n\n| Tên biến  | Ý nghĩa                                                                                 | Khoảng giá trị               |\n|-----------|-----------------------------------------------------------------------------------------|------------------------------|\n| id        | số thứ tự trẻ                                                                           |                              |\n| gioitinh  | giới tính                                                                               | nam, nữ                      |\n| ngaysinh  | ngày sinh của trẻ                                                                       | \\[01/01/2014, 01/04/2024\\]   |\n| huyen     | địa chỉ đăng ký tiêm chủng                                                              |                              |\n| xa        | địa chỉ đăng ký tiêm chủng                                                              |                              |\n| tinh      | địa chỉ đăng ký tiêm chủng                                                              |                              |\n| VGB \\<24  | Ngày tiêm mũi vắc xin Viêm gan B sơ sinh trước 24h                                      |                              |\n| VGB \\>24  | Ngày tiêm mũi vắc xin Viêm gan B sơ sinh sau 24h (tiêm trong vòng 28 ngày đầu sau sinh) |                              |\n| VGB_1     | Ngày tiêm mũi tiêm chứa kháng nguyên Viêm gan B mũi 1                                   |                              |\n| VGB_2     | Ngày tiêm mũi tiêm chứa kháng nguyên Viêm gan B mũi 2                                   |                              |\n| VGB_3     | Ngày tiêm mũi tiêm chứa kháng nguyên Viêm gan B mũi 3                                   |                              |\n| VGB_4+    | Ngày tiêm mũi tiêm chứa kháng nguyên Viêm gan B mũi 4 trở lên (mũi gần nhất)            |                              |\n| HG_1      | Ngày tiêm mũi tiêm chứa kháng nguyên ho gà mũi 1                                        |                              |\n| HG_2      | Ngày tiêm mũi tiêm chứa kháng nguyên ho gà mũi 2                                        |                              |\n| HG_3      | Ngày tiêm mũi tiêm chứa kháng nguyên ho gà mũi 3                                        |                              |\n| HG_4+     | Ngày tiêm mũi tiêm chứa kháng nguyên ho gà mũi 4 trở lên (mũi gần nhất)                 |                              |\n| UV_1      | Ngày tiêm mũi tiêm chứa kháng nguyên uốn ván mũi 1                                      |                              |\n| UV_2      | Ngày tiêm mũi tiêm chứa kháng nguyên uốn ván mũi 2                                      |                              |\n| UV_3      | Ngày tiêm mũi tiêm chứa kháng nguyên uốn ván mũi 3                                      |                              |\n| UV_4+     | Ngày tiêm mũi tiêm chứa kháng nguyên uốn ván mũi 4 trở lên (mũi gần nhất)               |                              |\n| tinhtrang | Trạng thái theo dõi                                                                     | \"ngừng theo dõi\", \"theo dõi\" |\n\n</details>\n\n::: callout-important\n### Lưu ý\n\nGiá trị của một đối tượng **có thể bị ghi đè** bất kỳ lúc nào bằng cách chạy lệnh gán để định nghĩa lại giá trị của nó. Do đó, **thứ tự của các lệnh được chạy rất quan trọng**.\n:::\n\nLệnh sau sẽ định nghĩa lại giá trị cho đối tượng `data_path`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_path <- \"data/new_path.xlsx\"\n\n# kiểm tra giá trị \ndata_path\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data/new_path.xlsx\"\n```\n:::\n:::\n\n\n## Câu văn trong R\n\nCâu lệnh (command) hoặc hàm (function) chính là những câu văn trong R để giao tiếp với máy tính. Chúng ta phải học ngữ pháp của 1 câu lệnh và ý nghĩa của nó để có thể sử dụng R để ra lệnh cho máy tính. Một câu lệnh trong R thường có dạng như sau:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntên-câu-lệnh(tên-tham-số = data-đầu-vào hoặc lựa-chọn)\n```\n:::\n\n\n-   Tên câu lệnh: nằm trước dấu `()`, thể hiện ý nghĩa câu lệnh dùng để làm gì.\n-   Tên tham số (argument): nằm trong dấu `()` là những tham số của câu lệnh đó. Tham số là những yêu cầu nhỏ và cụ thể để máy tính hiểu rõ hơn yêu cầu của người dùng.\n-   Dấu `=`: dùng để gán 1 giá trị cho tham số. Giá trị gán cho tham số có thể là một data đầu vào, hoặc một lựa chọn của người dùng (đúng/sai).\n\n**VD**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax(x = df$id, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1000\n```\n:::\n:::\n\n\n-   Tên câu lệnh là `max`: chúng ta đang yêu cầu máy tính hãy tìm giá trị lớn nhất của 1 biến.\n-   Các tham số là `x` và `na.rm`:\n    -   `x`: là data đầu vào, ở đây chúng ta viết `x = df$id` để cho máy tính biết data đầu vào là cột `id` trong bảng data `df`.\n    -   `na.rm`: là yêu cầu cụ thể cách giải quyết khi gặp missing value (NA), ở đây chúng ta lựa chọn `na.rm = TRUE` nghĩa là nếu cột `id` có NA thì bỏ những giá trị NA đi trước khi tìm giá trị lớn nhất.\n\n::: callout-tip\nĐể đọc hướng dẫn sử dụng về câu lệnh, gõ `?tên-câu-lệnh`.\n:::\n\n## Loại dữ liệu (datatype) trong R\n\nTrong R, mỗi đối tượng được quy định phải theo 1 loại dữ liệu (datatype) nhất định\n\n### Các datatype trong R\n\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| Datatype     | Ý nghĩa                                                                                            | Ví dụ                         |\n+==============+====================================================================================================+===============================+\n| `numeric`    | dữ liệu dạng số                                                                                    | -1, -2, 0, 1.5, ...           |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `logical`    | dữ liệu dạng đúng/sai                                                                              | \\[TRUE, FALSE\\] hoặc \\[1, 0\\] |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `character`  | dữ liệu dạng ký tự (hay còn gọi là string), được đặt trong dấu ngoặc kép `\"\"`.\\                    |                               |\n|              | đối tượng dạng ký tự thì **không thể tính toán**                                                   |                               |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `Date`       | dữ liệu ngày tháng                                                                                 | 2024-04-01, 2024-04-02, ...   |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `factor`     | dữ liệu dạng phân loại (categorical)                                                               | giới tính: nam, nữ\\           |\n|              |                                                                                                    | tỉnh thành\\                   |\n|              |                                                                                                    | dân tộc                       |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `data.frame` | dữ liệu dạng bảng                                                                                  |                               |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n| `tibble`     | dữ liệu dạng bảng tương tự như data.frame, sự khác biệt chính là tibble in đẹp hơn trong R console |                               |\n+--------------+----------------------------------------------------------------------------------------------------+-------------------------------+\n\n::: callout-tip\nĐể kiểm tra datatype của 1 đối tượng, sử dụng lệnh `class(tên_đối_tượng)`\n\nĐể kiểm tra datatype của các cột trong data.frame, ta có thể sử dụng lệnh `str` hoặc kiểm tra tại mục `Data` của RStudio\n\n![](img/clean_p1/view_datatype.png){width=\"311\"}\n:::\n\nVD:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# kiểm tra datatype của df\nclass(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n:::\n\n```{.r .cell-code}\n# kiểm tra datatype của các cột trong df\nstr(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [1,000 × 21] (S3: tbl_df/tbl/data.frame)\n $ id       : num [1:1000] 1 2 3 4 5 6 7 8 9 10 ...\n $ gioitinh : chr [1:1000] \"nam\" \"nữ\" \"nữ\" \"nữ\" ...\n $ ngaysinh : chr [1:1000] \"27/02/2024\" \"06/03/2024\" \"27/01/2024\" \"12/02/2024\" ...\n $ huyen    : chr [1:1000] \"Bình Chánh\" \"Huyện Thạnh Phú\" \"Thành phố Vĩnh Long\" \"Hóc Môn\" ...\n $ xa       : chr [1:1000] \"Phường Bình Hưng Hòa\" \"Phường 01\" \"Phường Phú Thuận\" \"Xã Đông Thạnh\" ...\n $ tinh     : chr [1:1000] \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" ...\n $ VGB <24  : chr [1:1000] \"28/02/2024\" \"07/03/2024\" \"28/01/2024\" \"13/02/2024\" ...\n $ VGB >24  : chr [1:1000] \"29/02/2024\" \"08/03/2024\" \"29/01/2024\" \"14/02/2024\" ...\n $ VGB_1    : chr [1:1000] \"10/03/2024\" \"23/03/2024\" \"08/02/2024\" \"17/02/2024\" ...\n $ VGB_2    : chr [1:1000] \"20/03/2024\" \"27/03/2024\" \"18/02/2024\" \"27/02/2024\" ...\n $ VGB_3    : chr [1:1000] \"20/03/2024\" \"11/04/2024\" \"19/02/2024\" \"28/02/2024\" ...\n $ VGB_4+   : chr [1:1000] \"04/04/2024\" \"26/04/2024\" \"19/02/2024\" \"28/02/2024\" ...\n $ HG_1     : chr [1:1000] \"28/02/2024\" \"07/03/2024\" \"28/01/2024\" \"12/02/2024\" ...\n $ HG_2     : chr [1:1000] \"02/03/2024\" \"22/03/2024\" \"07/02/2024\" \"16/02/2024\" ...\n $ HG_3     : chr [1:1000] \"12/03/2024\" \"06/04/2024\" \"17/02/2024\" \"02/03/2024\" ...\n $ HG_4+    : chr [1:1000] \"12/03/2024\" \"16/04/2024\" \"27/02/2024\" \"12/03/2024\" ...\n $ UV_1     : chr [1:1000] \"27/02/2024\" \"07/03/2024\" \"27/01/2024\" \"12/02/2024\" ...\n $ UV_2     : chr [1:1000] \"28/02/2024\" \"22/03/2024\" \"06/02/2024\" \"22/02/2024\" ...\n $ UV_3     : chr [1:1000] \"09/03/2024\" \"06/04/2024\" \"21/02/2024\" \"08/03/2024\" ...\n $ UV_4+    : chr [1:1000] \"19/03/2024\" \"21/04/2024\" \"02/03/2024\" \"23/03/2024\" ...\n $ tinhtrang: chr [1:1000] \"theo dõi\" \"ngừng theo dõi\" \"ngừng theo dõi\" \"theo dõi\" ...\n```\n:::\n:::\n\n\n### Chuyển đổi datatype {#sec-update-datatype}\n\nCú pháp chung cho thay đổi datatype là `as.datatype()`\n\nVí dụ như:\n\n-   `as.numeric()` chuyển thành định dạng số.\n\n-   `as.character()` chuyển thành định dạng văn bản.\n\n-   `as.factor()` chuyển thành định dạng factor.\n\n-   `as.Date()` chuyển thành định dạng ngày.\n\nNgoài ra, còn có các lệnh khác để phục vụ cho các mục đích cụ thể hơn, bao gồm:\n\n-   `ifelse()` chuyển thành định dạng logical theo điều kiện nhất định\n\n-   `is.na()` chuyển thành định dạng logical, các dữ liệu trống (`NA`) có giá trị `TRUE` và ngược lại.\n\n-   `dmy()`, `ymd()`, `mdy()`, ... chuyển đổi string theo các format khác nhau thành định dạng ngày\n\n## Các thao tác thông dụng với data.frame {#sec-df-row-col}\n\n### Làm sạch tên cột {#sec-clean_colnames}\n\nTrong R, tên cột là giá trị trên đỉnh của một cột.\n\nCác quy tắc cho tên cột thường bao gồm:\n\n-   Tên ngắn\n\n-   Không có khoảng trắng (thay thế bằng dấu gạch dưới \\_ ).\n\n-   Không có ký tự đặc biệt (&, #, \\<, \\>, ...) hoặc dấu.\n\n-   Không bắt đầu bằng số.\n\nLệnh `clean_names()` của package `janitor` được sử dụng để tự động hoá quá trình chuẩn hoá tên cột. Ngoài ra, lệnh `rename()` của package `dplyr` được sử dụng để thay đổi tên cột một cách thủ công.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% colnames()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"id\"        \"gioitinh\"  \"ngaysinh\"  \"huyen\"     \"xa\"        \"tinh\"     \n [7] \"VGB <24\"   \"VGB >24\"   \"VGB_1\"     \"VGB_2\"     \"VGB_3\"     \"VGB_4+\"   \n[13] \"HG_1\"      \"HG_2\"      \"HG_3\"      \"HG_4+\"     \"UV_1\"      \"UV_2\"     \n[19] \"UV_3\"      \"UV_4+\"     \"tinhtrang\"\n```\n:::\n\n```{.r .cell-code}\ndf %>% clean_names() %>% colnames()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"id\"        \"gioitinh\"  \"ngaysinh\"  \"huyen\"     \"xa\"        \"tinh\"     \n [7] \"vgb_24\"    \"vgb_24_2\"  \"vgb_1\"     \"vgb_2\"     \"vgb_3\"     \"vgb_4\"    \n[13] \"hg_1\"      \"hg_2\"      \"hg_3\"      \"hg_4\"      \"uv_1\"      \"uv_2\"     \n[19] \"uv_3\"      \"uv_4\"      \"tinhtrang\"\n```\n:::\n\n```{.r .cell-code}\ndf <- df %>% \n  clean_names() %>% # dùng clean names để tự động làm sạch tên cột\n  rename( # dùng rename để chỉnh sửa thêm\n    vgb_truoc_24 = vgb_24,\n    vgb_sau_24 = vgb_24_2\n  )\n```\n:::\n\n\n::: callout-important\n#### Lưu ý\n\n-   Dấu `<-` được sử dụng ở VD trên để **gán giá trị mới** vào cột Country (tương đương việc UPDATE cột)\n\n-   Nếu không sử dụng `<-` thì R chỉ trả về kết quả của các câu lệnh nhưng bảng df sẽ **không** có thay đổi\n:::\n\n::: callout-tip\n### Xem tên các cột {.callout-tip}\n\nLệnh `colnames` được sử dụng để xem danh sách tên các cột trong bảng\n:::\n\n::: callout-note\n### Dấu `%>% (pipe)` {.callout-note}\n\n`%>%` được dùng để chuyển đối tượng vào 1 function (trong VD đầu, `%>%` chuyển `df` vào function `colnames`)\n\n`%>%` còn thường được dùng để chuyển các kết quả trung gian sang function tiếp theo, từ đó có thể dùng để nối 1 chuỗi các function để thao tác trên 1 đối tượng\n:::\n\n### Lấy dữ liệu theo hàng/cột\n\n-   Cú pháp: `tên_bảng_dữ_liệu[hàng, cột]`. Trong đó cột có thể là số thứ tự của cột hoặc tên cột.\n\n-   Để lấy toàn bộ hàng thì để trống cột và ngược lại\n\n-   Để lấy nhiều cột hay hàng thì cho tên cột hay hàng theo dạng list (chuỗi)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# lấy dữ liệu tại hàng thứ 5, cột thứ 2\ndf[5 ,2]\n\n# lấy dữ liệu tại hàng thứ 5, cột \"vgb_truoc_24\"\ndf[5 , \"vgb_truoc_24\"]\n\n# lấy hàng thứ 5 trong bảng df\ndf[5, ]\n\n#lấy các cột id, ngaysinh, vgb_truoc_24\ndf[, c(\"id\", \"ngaysinh\", \"vgb_truoc_24\")] \n\n#lấy 10 hàng đầu tiên của các cột Country, Year, GDP\n#1:10 là cú pháp nhanh để tạo chuỗi từ 1 đến 10\ndf[1:10, c(\"id\", \"ngaysinh\", \"vgb_truoc_24\")] \n```\n:::\n\n\n::: callout-note\nĐối với cột, còn có cách trích xuất thông dụng khác bằng cách sử dụng dấu `$`. Tuy nhiên, cách này sẽ chỉ trích xuất giá trị trong 1 cột.\\\n**VD**: `df$col1` sẽ trả về các giá trị trong cột `col1` của bảng `df`\n:::\n\n### Chuyển đổi datatype cho cột\n\nKhi đọc dữ liệu vào R, các cột sẽ được tự động chuyển thành datatype hợp lý nhất\n\nTrong df, cột `id` được tự động chuyển thành dạng `numeric`\n\nTuy nhiên, có nhiều cột cần người dùng chuyển một cách thủ công, bao gồm:\n\n-   Các cột ngày tháng (`ngaysinh` và các cột ngày tiêm): R không thể tự động chuyển sang `Date` vì format này không khớp với format thông dụng (`YYYY-MM-dd` , `YYYY/MM/dd`, ...)\n\n-   Cột `gioitinh` nên được đổi thành `factor` để hỗ trợ trong quá trình phân tích về sau\n\n-   Cột `tinhtrang` nên được đổi thành `logical` để thể hiện đúng ý nghĩa là biến đúng/sai\n\nĐể thay đổi datatype của cột, ta có thể áp dụng các [function từ phần trước](#update_datatype).\n\n**VD**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndate_cols <- c(\"ngaysinh\", \"vgb_truoc_24\",\"vgb_sau_24\",\"vgb_1\",\"vgb_2\",\"vgb_3\",\"vgb_4\",\"hg_1\",\"hg_2\",\"hg_3\",\"hg_4\",\"uv_1\",\"uv_2\",\"uv_3\",\"uv_4\")\n\ndf <- df %>% \n  mutate(\n    gioitinh = as.factor(gioitinh),\n    tinhtrang = ifelse(tinhtrang == \"theo dõi\", TRUE, FALSE)\n  ) %>% \n  mutate_at(\n    # áp dụng lệnh dmy lên tất cả các cột ngày\n    date_cols, \n    dmy\n  ) %>% \n  rename(\n    theodoi = tinhtrang\n  )\n\nstr(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [1,000 × 21] (S3: tbl_df/tbl/data.frame)\n $ id          : num [1:1000] 1 2 3 4 5 6 7 8 9 10 ...\n $ gioitinh    : Factor w/ 2 levels \"nam\",\"nữ\": 1 2 2 2 2 2 1 1 1 1 ...\n $ ngaysinh    : Date[1:1000], format: \"2024-02-27\" \"2024-03-06\" ...\n $ huyen       : chr [1:1000] \"Bình Chánh\" \"Huyện Thạnh Phú\" \"Thành phố Vĩnh Long\" \"Hóc Môn\" ...\n $ xa          : chr [1:1000] \"Phường Bình Hưng Hòa\" \"Phường 01\" \"Phường Phú Thuận\" \"Xã Đông Thạnh\" ...\n $ tinh        : chr [1:1000] \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" \"Thành phố Hồ Chí Minh\" ...\n $ vgb_truoc_24: Date[1:1000], format: \"2024-02-28\" \"2024-03-07\" ...\n $ vgb_sau_24  : Date[1:1000], format: \"2024-02-29\" \"2024-03-08\" ...\n $ vgb_1       : Date[1:1000], format: \"2024-03-10\" \"2024-03-23\" ...\n $ vgb_2       : Date[1:1000], format: \"2024-03-20\" \"2024-03-27\" ...\n $ vgb_3       : Date[1:1000], format: \"2024-03-20\" \"2024-04-11\" ...\n $ vgb_4       : Date[1:1000], format: \"2024-04-04\" \"2024-04-26\" ...\n $ hg_1        : Date[1:1000], format: \"2024-02-28\" \"2024-03-07\" ...\n $ hg_2        : Date[1:1000], format: \"2024-03-02\" \"2024-03-22\" ...\n $ hg_3        : Date[1:1000], format: \"2024-03-12\" \"2024-04-06\" ...\n $ hg_4        : Date[1:1000], format: \"2024-03-12\" \"2024-04-16\" ...\n $ uv_1        : Date[1:1000], format: \"2024-02-27\" \"2024-03-07\" ...\n $ uv_2        : Date[1:1000], format: \"2024-02-28\" \"2024-03-22\" ...\n $ uv_3        : Date[1:1000], format: \"2024-03-09\" \"2024-04-06\" ...\n $ uv_4        : Date[1:1000], format: \"2024-03-19\" \"2024-04-21\" ...\n $ theodoi     : logi [1:1000] TRUE FALSE FALSE TRUE TRUE TRUE ...\n```\n:::\n:::\n\n\n::: callout-note\n### Lệnh `mutate` và `mutate_at`\n\n`mutate` được sử dụng để chỉnh sửa giá trị của cột hoặc tạo cột mới\n\n`mutate_at` được sử dụng khi cần chỉnh sửa nhiều cột cùng lúc\n:::\n\n### Lọc dữ liệu {#sec-filter-conditions}\n\nFunction `filter()` được sử dụng cho việc lọc dữ liệu theo điều kiện\\\nMột số ký tự thường được sử dụng để quy định điều kiện bao gồm:\n\n| Ký tự      | Ý nghĩa               |\n|------------|-----------------------|\n| `x == y`   | x bằng y              |\n| `x != y`   | x không bằng y        |\n| `x < y`    | x nhỏ hơn y           |\n| `x <= y`   | x nhỏ hơn hoặc bằng y |\n| `is.na(x)` | x trống               |\n| `A & B`    | A và B                |\n| `A | B`    | A hoặc B              |\n| `!`        | Không là (NOT)        |\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lọc các dữ liệu của quận 2\ndf %>% filter(huyen == \"Quận 2\") %>% select(id, huyen)\n\n# Lọc các trẻ có ngày tiêm vgb_1 trước ngày 20/2/2024 \ndf %>% filter(vgb_1 < as.Date(\"2024-02-20\")) %>% select(id, vgb_1)\n\n# Lọc các trẻ ở quận 2 hoặc trước ngày 20/02/2024\ndf %>% filter(huyen == \"Quận 2\" | vgb_1 < as.Date(\"2024-02-20\")) %>% select(id, huyen, vgb_1)\n\n# Lọc các trẻ ở quận 2 và trước ngày 20/02/2024\ndf %>% filter(huyen == \"Quận 2\" & vgb_1 < as.Date(\"2024-02-20\")) %>% select(id, huyen, vgb_1)\n```\n:::\n\n\n## Dữ liệu string\n\nGói `stringr` (1 trong các package trong `tidyverse`) thường được sử dụng để xử lý các dữ liệu dạng string.\n\nNgoài ra, R còn có package `stringi` dành cho các mục đích cụ thể khác (VD như xử lý dấu, cách mã hoá văn bản, ... )\n\n|                      |             |                                     |\n|----------------------|-------------|-------------------------------------|\n| **Function**         | **Package** | **Công dụng**                       |\n| `tolower`            | base        | biến thành chữ thường               |\n| `toupper`            | base        | biến thành chữ hoa                  |\n| `str_to_title`       | stringr     | in hoa chữ cái đầu tiên của từng từ |\n| `stri_trans_general` | stringi     | loại bỏ dấu                         |\n\n**VD**: xoá dấu trong cột `tinh` `huyen` `xa`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  mutate(\n    tinh_mod = stri_trans_general(tinh, \"latin-ascii\"),\n    huyen_mod = stri_trans_general(huyen, \"latin-ascii\"),\n    xa_mod = stri_trans_general(xa, \"latin-ascii\")\n  ) %>% \n  select(id, tinh, tinh_mod, huyen, huyen_mod, xa, xa_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,000 × 7\n      id tinh                  tinh_mod             huyen huyen_mod xa    xa_mod\n   <dbl> <chr>                 <chr>                <chr> <chr>     <chr> <chr> \n 1     1 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Bình… Binh Cha… Phườ… Phuon…\n 2     2 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Huyệ… Huyen Th… Phườ… Phuon…\n 3     3 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Thàn… Thanh ph… Phườ… Phuon…\n 4     4 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Hóc … Hoc Mon   Xã Đ… Xa Do…\n 5     5 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Bình… Binh Cha… Xã B… Xa Bi…\n 6     6 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Quận… Quan 7    Phú … Phu T…\n 7     7 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Bình… Binh Tha… 22    22    \n 8     8 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Quận… Quan 8    10    10    \n 9     9 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Củ C… Cu Chi    Xã A… Xa An…\n10    10 Thành phố Hồ Chí Minh Thanh pho Ho Chi Mi… Cần … Can Gio   Lý N… Ly Nh…\n# ℹ 990 more rows\n```\n:::\n:::\n\n\n### Các hàm thông dụng của stringr\n\n|                   |                                                                             |\n|-------------------|-----------------------------------------------------------------------------|\n| **Function**      | **Công dụng**                                                               |\n| `str_starts`      | lọc hàng bắt đầu bằng chuỗi ký tự khớp với pattern                          |\n| `str_ends`        | lọc hàng kết thúc bằng bằng chuỗi ký tự khớp với pattern                    |\n| `str_detect`      | lọc hàng có chứa chuỗi ký tự khớp với pattern                               |\n| `str_interp`      | chèn giá trị vào string (string interpolation)                              |\n| `str_extract`     | trích 1 chuỗi con (substring) đầu tiên khớp với pattern                     |\n| `str_extract_all` | trích tất cả các chuỗi con (substring) khớp với pattern                     |\n| `str_remove`      | xoá 1 chuỗi con (substring) đầu tiên khớp với pattern                       |\n| `str_remove_all`  | xoá tất cả các chuỗi con (substring) khớp với pattern                       |\n| `str_replace`     | thay thế 1 chuỗi con (substring) đầu tiên khớp với pattern bằng 1 chuỗi mới |\n| `str_replace_all` | thay thế tất cả chuỗi con (substring) khớp với pattern bằng 1 chuỗi mới     |\n\n::: center-text\n[{{< fa link >}} stringr functions](https://stringr.tidyverse.org/reference/index.html){.btn .btn-outline-secondary role=\"button\"}\n:::\n\n### Regex\n\nTrong R, regex là 1 ngôn ngữ ngắn gọn để mô tả các patterns trong string\n\nCó bốn công cụ cơ bản mà người dùng có thể sử dụng để tạo một biểu thức chính quy cơ bản:\n\n-   Nhóm\n-   Bộ ký tự\n-   Siêu ký tự\n-   Bộ định lượng\n\n**Nhóm** chỉ định các chuỗi cần khớp. Thường được viết trong`()` và phân cách bởi dấu `|`\n\n*VD*: `\"(Quận|Huyện)\"` - quy định cần khớp chữ `\"Quận\"` hay `\"Huyện\"`.\n\n**Bộ ký tự** string được đánh giá khớp tìm thấy bất kỳ ký tự nào trong dấu ngoặc `[ ]` trong chuỗi. Vd, để tìm string chứa các nguyên âm, người ta có thể sử dụng bộ ký tự này: `\"[aeiou]\"`.\n\nCác bộ ký tự đặc biệt trong R\n\n| Bộ ký tự      | Ý nghĩa                                      |\n|---------------|----------------------------------------------|\n| `\"[A-Z]\"`     | bất kỳ chữ cái viết hoa đơn lẻ nào           |\n| `\"[a-z]\"`     | bất kỳ chữ cái viết thường đơn lẻ nào        |\n| `\"[0-9]\"`     | bất kỳ số nào                                |\n| `\"[:alnum:]\"` | bất kỳ chữ cái và số nào                     |\n| `\"[:digit:]\"` | bất kỳ chữ số nào                            |\n| `\"[:alpha:]\"` | bất kỳ ký tự nào (viết hoa hoặc viết thường) |\n| `\"[:upper:]\"` | bất kỳ ký tự viết hoa nào                    |\n| `\"[:lower:]\"` | bất kỳ ký tự viết thường nào                 |\n\n**Bộ định lượng** chỉ định độ dài của pattern Bộ định lượng là các số được viết trong dấu ngoặc nhọn `{ }` sau pattern mà chúng đang định lượng. Ngoài ra có 2 ký tự đặc biệt khác cho bộ định lượng, bao gồm:\n\n-   Dấu `*` : khớp khi có 0 hoặc nhiều hơn pattern được định lượng.\n\n-   Dấu `+` : khớp khi có 1 hoặc nhiều hơn pattern được định lượng.\n\n*VD*:\n\n-   `\"A{2}\"` quy định khớp khi có hai chữ cái A viết hoa.\n\n-   `\"[:digit:]{2}\"` quy định khớp khi có hai chữ số.\n\n-   `\"[:alpha:]+\"` quy định khớp khi có ít nhất 1 chữ cái.\n\n**Siêu ký tự** là phiên bản rút ngắn của 1 số bộ ký tự\n\n| Siêu ký tự | Ý nghĩa                   |\n|------------|---------------------------|\n| `\"\\\\s\"`    | khoảng trắng đơn          |\n| `\"\\\\w\"`    | tương đương \"\\[:alnum:\\]\" |\n| `\"\\\\d\"`    | tương đương \"\\[:digit:\\]\" |\n\n### Một số ví dụ sử dụng hàm của `stringr` cùng regex\n\n***VD1***: Tìm các hàng có xã số\n\n-   Chọn câu lệnh: cần tìm theo tên --\\> [cần kiểm tra chữ cuối]{.underline} trong string -\\>dùng lệnh `str_detect`\n-   Quy định pattern bằng regex: cần string chứa số-\\> áp dụng **Nhóm**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  filter(\n    str_detect(xa, \"[:digit:]\")\n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 390 × 21\n      id gioitinh ngaysinh   huyen           xa    tinh  vgb_truoc_24 vgb_sau_24\n   <dbl> <fct>    <date>     <chr>           <chr> <chr> <date>       <date>    \n 1     2 nữ       2024-03-06 Huyện Thạnh Phú Phườ… Thàn… 2024-03-07   2024-03-08\n 2     7 nam      2024-02-03 Bình Thạnh      22    Thàn… 2024-02-03   2024-02-04\n 3     8 nam      2024-01-24 Quận 8          10    Thàn… 2024-01-24   2024-01-25\n 4    15 nam      2024-02-26 Quận 11         Phườ… Thàn… 2024-02-26   2024-02-27\n 5    19 nữ       2024-01-30 Phú Nhuận       Phườ… Thàn… 2024-01-30   2024-01-31\n 6    23 nam      2024-02-07 Thành phố Long… Phườ… Thàn… 2024-02-08   2024-02-09\n 7    26 nam      2024-01-03 Quận 10         Phườ… Thàn… 2024-01-04   2024-01-05\n 8    27 nữ       2024-01-03 Gò vấp          Phườ… Thàn… 2024-01-04   2024-01-05\n 9    32 nữ       2024-03-19 NA              12    Thàn… 2024-03-19   2024-03-20\n10    34 nam      2024-02-20 Thị xã Bình Lo… Phườ… Thàn… 2024-02-21   2024-02-22\n# ℹ 380 more rows\n# ℹ 13 more variables: vgb_1 <date>, vgb_2 <date>, vgb_3 <date>, vgb_4 <date>,\n#   hg_1 <date>, hg_2 <date>, hg_3 <date>, hg_4 <date>, uv_1 <date>,\n#   uv_2 <date>, uv_3 <date>, uv_4 <date>, theodoi <lgl>\n```\n:::\n:::\n\n\n***VD 2***: cần tìm các trẻ ở quận Phú Nhuận hoặc Bình Thạnh\n\nChọn câu lệnh: cần lọc các hàng có `huyen` [chứa dòng chữ]{.underline} \"Phú Nhuận\" hoặc \"Bình Thạnh\" --\\> dùng lệnh `str_detect`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  filter(\n    str_detect(\n      huyen, \n      \"(Phú Nhuận|Bình Thạnh)\"\n    )\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 75 × 21\n      id gioitinh ngaysinh   huyen      xa        tinh   vgb_truoc_24 vgb_sau_24\n   <dbl> <fct>    <date>     <chr>      <chr>     <chr>  <date>       <date>    \n 1     7 nam      2024-02-03 Bình Thạnh 22        Thành… 2024-02-03   2024-02-04\n 2    19 nữ       2024-01-30 Phú Nhuận  Phường 15 Thành… 2024-01-30   2024-01-31\n 3    48 nữ       2024-02-28 Phú Nhuận  Phường 15 Thành… 2024-02-28   2024-02-29\n 4    73 nữ       2024-01-03 Bình Thạnh 17        Thành… 2024-01-03   2024-01-04\n 5    97 nam      2024-02-25 Bình Thạnh 11        Thành… 2024-02-26   2024-02-27\n 6    98 nam      2024-02-21 Bình Thạnh Phường 17 Thành… 2024-02-22   2024-02-23\n 7   104 nam      2024-01-11 Bình Thạnh Phường 11 Thành… 2024-01-12   2024-01-13\n 8   108 nam      2024-01-03 Bình Thạnh Phường 03 Thành… 2024-01-04   2024-01-05\n 9   110 nam      2024-01-22 Phú Nhuận  Phường 08 Thành… 2024-01-22   2024-01-23\n10   126 nữ       2024-02-16 Phú Nhuận  Phường 15 Thành… 2024-02-16   2024-02-17\n# ℹ 65 more rows\n# ℹ 13 more variables: vgb_1 <date>, vgb_2 <date>, vgb_3 <date>, vgb_4 <date>,\n#   hg_1 <date>, hg_2 <date>, hg_3 <date>, hg_4 <date>, uv_1 <date>,\n#   uv_2 <date>, uv_3 <date>, uv_4 <date>, theodoi <lgl>\n```\n:::\n:::\n\n\n## Dữ liệu ngày tháng\n\nĐối với dữ liệu dạng ngày tháng, package thông dụng nhất là `lubridate` (cũng là 1 phần của tidyverse).\n\n### Các lệnh liên quan đến ngày tháng\n\n| Function            | Công dụng                                           | Package   |\n|---------------------|-----------------------------------------------------|-----------|\n| `difftime`          | tính khoảng cách giữa hai mốc thời gian             | base      |\n| `month`/`year`      | lấy tháng/ năm                                      | lubridate |\n| `quarter`           | chuyển ngày sang quý                                | lubridate |\n| `today`             | lấy ngày hiện tại                                   | lubridate |\n| `dmy`, `ymd`, `mdy` | chuyển string theo nhiều format khác nhau sang ngày | lubridate |\n\n::: center-text\n[{{< fa link >}} lubridate functions](https://lubridate.tidyverse.org/reference/index.html){.btn .btn-outline-secondary role=\"button\"}\n:::\n\n**VD**: tìm các trẻ được tiêm vgb_2 trong 1 tháng kể từ ngày sinh\n\n-   Cần tính khoảng thời gian từ lúc cấp chứng chỉ đến hiện tại -\\> dùng lệnh `difftime()` với unit là days (difftime không có unit month) sau đó chia cho 365\n\n<!-- -->\n\n-   [hoặc]{.underline} dùng lệnh `month` để lấy tháng của 2 mốc thời gian rồi trừ nhau\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# --- Cách 1\ndf %>% \n  filter(\n    # gọi difftime để tính khoảng cách thời gian\n    difftime(vgb_2, ngaysinh, units = \"days\")/30 <= 2\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 990 × 21\n      id gioitinh ngaysinh   huyen           xa    tinh  vgb_truoc_24 vgb_sau_24\n   <dbl> <fct>    <date>     <chr>           <chr> <chr> <date>       <date>    \n 1     1 nam      2024-02-27 Bình Chánh      Phườ… Thàn… 2024-02-28   2024-02-29\n 2     2 nữ       2024-03-06 Huyện Thạnh Phú Phườ… Thàn… 2024-03-07   2024-03-08\n 3     3 nữ       2024-01-27 Thành phố Vĩnh… Phườ… Thàn… 2024-01-28   2024-01-29\n 4     4 nữ       2024-02-12 Hóc Môn         Xã Đ… Thàn… 2024-02-13   2024-02-14\n 5     5 nữ       2024-02-21 Bình Chánh      Xã B… Thàn… 2024-02-21   2024-02-20\n 6     6 nữ       2024-03-07 Quận 7          Phú … Thàn… 2024-03-07   2024-03-08\n 7     7 nam      2024-02-03 Bình Thạnh      22    Thàn… 2024-02-03   2024-02-04\n 8     8 nam      2024-01-24 Quận 8          10    Thàn… 2024-01-24   2024-01-25\n 9     9 nam      2024-01-14 Củ Chi          Xã A… Thàn… 2024-01-15   2024-01-16\n10    10 nam      2024-01-14 Cần Giờ         Lý N… Thàn… 2024-01-15   2024-01-16\n# ℹ 980 more rows\n# ℹ 13 more variables: vgb_1 <date>, vgb_2 <date>, vgb_3 <date>, vgb_4 <date>,\n#   hg_1 <date>, hg_2 <date>, hg_3 <date>, hg_4 <date>, uv_1 <date>,\n#   uv_2 <date>, uv_3 <date>, uv_4 <date>, theodoi <lgl>\n```\n:::\n\n```{.r .cell-code}\n# --- Cách 2\ndf %>% \n  filter(\n    # Gọi month để lấy tháng sau đó trừ nhau\n    month(vgb_2) - month(ngaysinh)  <= 2\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 990 × 21\n      id gioitinh ngaysinh   huyen           xa    tinh  vgb_truoc_24 vgb_sau_24\n   <dbl> <fct>    <date>     <chr>           <chr> <chr> <date>       <date>    \n 1     1 nam      2024-02-27 Bình Chánh      Phườ… Thàn… 2024-02-28   2024-02-29\n 2     2 nữ       2024-03-06 Huyện Thạnh Phú Phườ… Thàn… 2024-03-07   2024-03-08\n 3     3 nữ       2024-01-27 Thành phố Vĩnh… Phườ… Thàn… 2024-01-28   2024-01-29\n 4     4 nữ       2024-02-12 Hóc Môn         Xã Đ… Thàn… 2024-02-13   2024-02-14\n 5     5 nữ       2024-02-21 Bình Chánh      Xã B… Thàn… 2024-02-21   2024-02-20\n 6     6 nữ       2024-03-07 Quận 7          Phú … Thàn… 2024-03-07   2024-03-08\n 7     7 nam      2024-02-03 Bình Thạnh      22    Thàn… 2024-02-03   2024-02-04\n 8     8 nam      2024-01-24 Quận 8          10    Thàn… 2024-01-24   2024-01-25\n 9     9 nam      2024-01-14 Củ Chi          Xã A… Thàn… 2024-01-15   2024-01-16\n10    10 nam      2024-01-14 Cần Giờ         Lý N… Thàn… 2024-01-15   2024-01-16\n# ℹ 980 more rows\n# ℹ 13 more variables: vgb_1 <date>, vgb_2 <date>, vgb_3 <date>, vgb_4 <date>,\n#   hg_1 <date>, hg_2 <date>, hg_3 <date>, hg_4 <date>, uv_1 <date>,\n#   uv_2 <date>, uv_3 <date>, uv_4 <date>, theodoi <lgl>\n```\n:::\n:::\n\n\nTrong 2 ví dụ trên, cách 1 sẽ chính xác hơn vì ta tính cả ngày khi sử dụng difftime còn cách 2 chỉ lấy 2 tháng trừ nhau\n\n## Lưu bảng dữ liệu sau khi chỉnh sửa {#sec-save-data}\n\nR cho phép lưu lại dữ liệu với nhiều format khác nhau, bao gồm:\n\n-   RData - định dạng dữ liệu của R để lưu trữ nhiều đối tượng\n\n-   RDS - định dạng dữ liệu của R để lưu trữ 1 đối tượng\n\n-   excel\n\n::: callout-important\n### Lưu ý\n\nTốc độ đọc file RData và RDS của R nhanh hơn rất nhiều so với việc đọc file excel.\\\nVì vậy, đối với các dữ liệu có số lượng lớn hoặc cần xử lý thêm trong R, nên lưu trữ dưới dạng RDS/Rdata.\n:::\n\n**VD:** lưu dữ liệu\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# định nghĩa đường dẫn đến folder chứa data\ndata_path <- file.path(getwd(), \"data\")\n\n# lưu dưới dạng Rdata\nsave(df, file = file.path(data_path, \"rda_data.Rda\"))\n\n# lưu dưới dạng RDS\nsaveRDS(df, file = file.path(data_path, \"rds_data.Rds\"))\n\n# lưu dưới dạng file excel\nwrite_xlsx(df, path = file.path(data_path, \"excel_data.xlsx\"))\n```\n:::\n\n\nĐọc dữ liệu được lưu\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# đọc file Rdata\nload(file.path(data_path, \"rda_data.Rda\"))\n\n# đọc file RDS\nreadRDS(file = file.path(data_path, \"rds_data.Rds\"))\n\n# đọc file excel\nread_excel(df, path = file.path(data_path, \"excel_data.xlsx\"))\n```\n:::\n\n\n## Thực hành\n\n### Đọc dữ liệu\n\nĐọc 2 bộ dữ liệu sau\n\n-   `life-exp.csv`\n\n-   `practising_cert.csv`\n\nVà làm sạch tên cột\n\n\n```{=html}\n<details>\n<summary>Code</summary>\n```\n\n::: {.cell}\n\n```{.r .cell-code}\nlife_exp_path <- \"data/life-exp.csv\"\npractising_cert_path <- \"data/practising_cert.csv\"\n\n# tạo đối tượng để lưu trữ bảng dữ liệu đọc từ file csv\nlife_exp_df <- read_csv(file = life_exp_path, show_col_types = FALSE)\npractising_cert_df <- read_csv(file = practising_cert_path, show_col_types = FALSE)\n\n# làm sạch tên cột \nlife_exp_df <- clean_names(life_exp_df)\npractising_cert_df <- clean_names(practising_cert_df)\n```\n:::\n\n```{=html}\n\n</details>\n```\n\n### Lọc dữ liệu đơn giản\n\nTừ bảng dữ liệu `life-exp`\n\n-   Lọc các dữ liệu của Thái Lan\n\n-   Lọc các hàng có `GDP` năm 2015 hơn 2000\n\n-   Lọc các hàng có `country` là Thailand **hoặc** `GDP` \\> 2000\n\n-   Lọc các hàng có `country` là Thailand **và** `GDP` \\> 2000\n\n**Note**: không cần lưu những dữ liệu được lọc\n\n\n```{=html}\n<details>\n  <summary>\n    Code \n  </summary>\n```\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lọc các dữ liệu của Thái Lan\nlife_exp_df %>% filter(country == \"Thailand\")\n\n# Lọc các hàng có GDP năm 2015 hơn 2000\nlife_exp_df %>% filter(year == 2015 & gdp > 2000)\n\n# Lọc các hàng có Country là Thailand hoặc GDP > 2000\nlife_exp_df %>% filter(country == \"Thailand\" | (gdp > 2000))\n\n# Lọc các hàng có Country là Thailand và GDP > 2000\nlife_exp_df %>% filter(country == \"Thailand\" & (gdp > 2000))\n```\n:::\n\n\n</details>\n\n### Lọc dữ liệu phức tạp\n\nCác bài thực hành sau sẽ được áp dụng trên dữ liệu `practising_cert.csv`\n\n#### Dữ liệu string\n\n1.  Tìm kiếm thông tin cho những ai có tên là Thịnh/Hằng/Diễm\n\n\n```{=html}\n<details>\n  <summary>\n    Gợi ý\n  </summary>\n```\n\n::: {.callout-caution icon=\"false\"}\n## Gợi ý\n\n-   Chọn câu lệnh: cần tìm theo tên --\\> cần kiểm tra chữ cuối trong string -\\>dùng lệnh `str_ends`\n\n-   Quy định pattern bằng regex: cần khớp với 1 trong các tên nêu trên -\\> áp dụng **Nhóm**\n:::\n\n</details>\n\n\n```{=html}\n<details>\n  <summary>Code</summary>\n```\n\n::: {.cell}\n\n```{.r .cell-code}\npractising_cert_df %>%\n  filter( # gọi filter để lọc\n    str_ends( # gọi lệnh str_ends để kiểm tra các ký tự cuối của string\n      ho_ten, # cần kiểm tra cột HoTen\n      \"(Thịnh|Hằng|Diễm)\" # quy định pattern cần khớp\n      )\n  )\n```\n:::\n\n\n</details>\n\n2.  Tìm thông tin cho những ai được cấp chứng chỉ chữa bệnh chuyên khoa răng hàm mặt hoặc mắt\n\n\n```{=html}\n<details>\n  <summary> Gợi ý </summary>\n```\n\n::: callout-caution\n## Gợi ý\n\nChọn câu lệnh: cần lọc các hàng có Phạm Vi Hoạt động [chứa dòng chữ]{.underline} \"răng hàm mặt\" hoặc \"mắt\" --\\> dùng lệnh `str_detect`\n:::\n\n</details>\n\n\n```{=html}\n<details>\n  <summary>Code</summary>\n```\n\n::: {.cell}\n\n```{.r .cell-code}\npractising_cert_df %>%\n  mutate(\n    # chuyển thành in thường để tránh các tình trạng không khớp vì khác case\n    ten_pham_vi_hoat_dong = tolower(ten_pham_vi_hoat_dong)\n  ) %>%\n  filter(\n    str_detect(\n      ten_pham_vi_hoat_dong,\n      \"(răng hàm mặt|mắt)\"\n    )\n  )\n```\n:::\n\n\n</details>\n\n#### Dữ liệu ngày tháng\n\nTìm những ai được cấp chứng chỉ hành nghề trong vòng 5 năm gần đây\n\n\n```{=html}\n<details>\n  <summary> Gợi ý </summary>\n```\n\n::: {.callout-caution icon=\"false\"}\n## Gợi ý\n\n-   Cần lấy ngày hiện tại để tính toán --\\> dùng lệnh `today()`\n\n-   Cần tính khoảng thời gian từ lúc cấp chứng chỉ đến hiện tại -\\> dùng lệnh `difftime()` với unit là days (difftime không có unit year) sau đó chia cho 365\n\n    [*hoặc*]{.underline} dùng lệnh `year` để lấy năm của 2 mốc thời gian rồi trừ nhau\n:::\n\n</details>\n\n\n```{=html}\n<details>\n  <summary> Code </summary>\n```\n\n::: {.cell}\n\n```{.r .cell-code}\n# --- Cách 1\npractising_cert_df %>%\n  filter(\n    # gọi difftime để tính khoảng cách thời gian\n    difftime(today(), ngay_cap_chung_chi, units = \"days\")/365 <= 5\n  )\n\n# --- Cách 2\npractising_cert_df %>%\n  filter(\n    # Gọi year để lấy năm sau đó trừ nhau\n    year(today()) - year(ngay_cap_chung_chi)  <= 5\n  )\n```\n:::\n\n\n</details>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}